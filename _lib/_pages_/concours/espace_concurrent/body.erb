<%
# frozen_string_literal: true
%>
<p><strong><%= concurrent.pseudo.titleize %></strong>, bienvenue dans votre espace du <strong>Concours de Synopsis de l’atelier Icare</strong>. Retrouvez dans cette partie les informations sur vos participation ainsi que des informations sur le concours actuel.<%=
  if concurrent.dossier_transmis?
    ""
  else
    " C'est ici que vous pouvez transmettre votre fichier de candidature."
  end
%></p>

<%
# ---------------------------------------------------------------------
#
# Informations sur le concours
# ----------------------------
# Ici une partie générale indiquant les informations sur le concours,
# avec notamment le nombre de concurrents actuels.
#
# ---------------------------------------------------------------------
%>
<fieldset id="concours-informations">
  <legend>Informations sur le concours en cours</legend>
  <% if Concours.current.started? %>
    <div class="row">
      <span class="libelle">Année</span>
      <span class="value bold"><%= concours.annee %></span>
    </div>
    <div class="row">
      <span class="libelle">Thème</span>
      <span class="value bold"><%= concours.theme %></span>
    </div>
    <div class="row">
      <span class="libelle">Échéance</span>
      <span class="value bold"><%= concours.h_echeance %></span>
    </div>
    <div class="row right mt2">
      <span class="italic">Nombre de concurrents inscrits : </span>
      <span id="nombre-concurrents">
        <% if concours.nombre_concurrents == 0 %>
          Vous serez le premier inscrit au concours !
        <% else %>
          <%= concours.nombre_concurrents.to_s.rjust(3, "0") %>
        <% end %>
      </span>
    </div>
  <%
    else # si le concours n'est pas en cours
  %>
    <div>
      Le prochain concours de synopsis n'est pas encore lancé.
    </div>
  <% end %>
</fieldset>

<%
# ---------------------------------------------------------------------
#
# Le concurrent a toujours la possibilité de changer sa préférence
# concernant la fiche de lecture
#
# ---------------------------------------------------------------------
%>
<fieldset>
  <legend>Vos préférences</legend>
  <div class="row">
    <% if concurrent.fiche_lecture? %>
      <div>Vous recevrez la fiche de lecture sur votre projet.</div>
      <div class="small right"><a href="<%= route.to_s %>?op=nonfl">Je ne veux plus recevoir cette fiche de lecture</a>.</div>
    <% else %>
      <div>Vous ne recevrez pas la fiche de lecture.</div>
      <div class="small right"><a href="<%= route.to_s %>?op=ouifl">Finalement, je veux bien recevoir cette fiche de lecture</a>.</div>
    <% end %>
  </div>

  <div class="row">
    <% if concurrent.warned?  %>
      <div>Vous recevez des informations sur le concours (échéances, inscrits, etc.).
      <div class="small right"><a href="<%= route.to_s %>?op=nonwarn">Je ne veux plus recevoir ces informations</a>.</div>
      </div>
    <% else %>
    <div>Vous ne recevez pas les informations sur le concours.
    <div class="small right"><a href="<%= route.to_s %>?op=ouiwarn">Finalement, je voudrais bien recevoir ces informations (échéances, inscrits, etc.)</a>.</div>
    <% end %>
  </div>
</fieldset>

<%
# ---------------------------------------------------------------------
#
# Si le concurrent n'a pas encore envoyé son dossier, il faut lui
# proposer de le faire avec un formulaire
#
# ---------------------------------------------------------------------
if Concours.current.started?
  # Le concours est en route
  if not concurrent.dossier_transmis?
    form = Form.new(id: "concours-dossier-form", route:route.to_s, class:"nomargin noborder nolibelle", file: true, value_size: "600px")
    form.rows = {
      "Votre fichier"   => {type:"file", name:"p_fichier_candidature"},
      "<lien dossier/>" => {type:"raw", content:"<div class=\"italic small\">Voir le détail du #{Tag.lien(route:"concours/dossier", text:"contenu du dossier")}.</div>"},
    }
    form.submit_button = UI_TEXTS[:concours_bouton_send_dossier]
  end
end # Si le concours est en route
%>
<fieldset id="concours-envoi-dossier">
  <legend>Fichier de candidature</legend>
  <% if Concours.current.started? %>
    <% if concurrent.dossier_transmis? %>
      <p>Votre fichier de candidature a bien été transmis.</p>
    <% else %>
      <%= form.out %>
    <% end %>
  <% else %>
    <div>
      Votre fichier de candidature pourra être transmis lorsque le prochain concours sera lancé.
    </div>
  <% end %>
</fieldset>


<%
# ---------------------------------------------------------------------
#
# Informations sur le concurrent et ses participations
#
# ---------------------------------------------------------------------
%>
<h3>Vos participations aux concours de l’atelier Icare</h3>
<section id="concours-historique">
  <% if concurrent.all_concours.count == 1 %>
    <p>C'est votre première participation à ce concours. Bonne chance à vous !</p>
  <% else %>
    <p>[Historique des participations]</p>
  <% end %>
</section>
